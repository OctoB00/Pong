using System;
using SFML.System;
using SFML.Window;
using SFML.Graphics;

namespace BouncingBall
{
    class Ball
    {
        public RectangleShape shape;
        public Vector2f velocity;

        public Ball()
        {
            this.shape = new RectangleShape(new Vector2f(20, 20));
            this.shape.Origin = new Vector2f(10, 10);
            shape.FillColor = Color.Red;
        }

        public void AddSpeed(Vector2f speed)
        {
            velocity += speed;
        }
        public void Update(float deltaTime)
        {
            Vector2f newPosition = shape.Position + velocity * deltaTime;

            if (newPosition.Y + shape.Origin.Y > 600
                || newPosition.Y - shape.Origin.Y < 0)
            {
                velocity = new Vector2f(velocity.X, -velocity.Y);
            }
            else if (newPosition.X - shape.Origin.X < 0
                 || newPosition.X + shape.Origin.X > 800)
            {
                velocity = new Vector2f(-velocity.X, velocity.Y);
            }
            else
            {
                shape.Position = newPosition;
            }
        }
        public void Render(RenderTarget target)
        {
            target.Draw(shape);
        }
        //public FloatRect GetBounds()
        //{
        //    shape.GetGlobalBounds();
        //}
    }
    class Line
    {
        public RectangleShape line;
        public Vector2f velocity;

        public Line()
        {
            this.line = new RectangleShape(new Vector2f(10, 100));
            this.line.Origin = new Vector2f(5, 50);
            line.FillColor = Color.White;
        }

        public void AddSpeed(Vector2f speed)
        {
            velocity += speed;
            Console.WriteLine(speed);
        }
        public void Update(float deltaTime)
        {
            Vector2f newPosition = line.Position + velocity * deltaTime;
            line.Position = newPosition;

            if (newPosition.Y + line.Origin.Y > 599
                || newPosition.Y - line.Origin.Y < 1)
            {
                velocity = new Vector2f(0, 0);
            }
            else
            {
                line.Position = newPosition;
            }
        }
        public void Render(RenderTarget target)
        {
            target.Draw(line);
        }
    }
    class Program
    {
        static void Main(string[] args)
        {
            using (var window = new RenderWindow(new VideoMode(800, 600), "Bouncing Ball"))
            {
                window.Closed += (s, e) => window.Close();
                Clock frameClock = new Clock();
                Ball ball = new Ball();
                ball.shape.Position = new Vector2f(400, 300);
                ball.AddSpeed(new Vector2f(100, 200));
                Line line1 = new Line();
                line1.line.Position = new Vector2f(50, 300);
                bool keyPressed = false;
                window.KeyPressed += (s, e) =>
                {
                    if (e.Code == Keyboard.Key.Up)
                    {
                        keyPressed = true;
                    }
                };
                window.KeyReleased += (s, e) =>
                {
                    if (e.Code == Keyboard.Key.Up)
                    {
                        keyPressed = true;
                    }
                };
                

                while (window.IsOpen)
                {
                    window.DispatchEvents();
                    window.Clear(new Color(131, 197, 235));
                    float deltaTime = frameClock.Restart().AsSeconds();
                    ball.Update(deltaTime);
                    ball.Render(window);
                    line1.Update(deltaTime);
                    line1.Render(window);
                    if (keyPressed)
                    {
                        line1.AddSpeed(new Vector2f(0, -50));
                    }
                    else
                    {
                        line1.AddSpeed(new Vector2f(0, 0));
                    }
                    //sprite1.GetGlobalBounds().Intersects(sprite2.GetBounds())

                    window.Display();
                }
            }
        }
    }
}
